== Form Validation and Submission

Now that we have a contact form, we have to handle the submission. We can do that by adding a new action that will be called when the form is submitted. Let's create a `submit.js` file.

[source,javascript]
----
function main(args) {
  let message = []
  let errors = []
  // TODO: Form Validation
  // TODO: Returning the Result
}
----

This action is a bit more complex. It takes the input object (called args) which will contain the form data (accessible via `args.name`, `args.email`, etc.). With that we will do some validation and then return the result.

=== Form Validation

Let's start filling the "Form Validation" part by checking the name:

[source,javascript]
----
// validate the name
if(args.name) {
 message.push("name: "+args.name)
} else {
 errors.push("No name provided")
}
----

Then the email by using a regular expression:
[source,javascript]
----
// validate the email
var re = /\S+@\S+\.\S+/;
if(args.email && re.test(args.email)) {
   message.push("email: "+args.email)
} else {
  errors.push("Email missing or incorrect.")
}
----

The phone, by checking that it's at least 10 digits:
[source,javascript]
----
// validate the phone
if(args.phone && args.phone.match(/\d/g).length >= 10) {
  message.push("phone: "+args.phone)
} else {
  errors.push("Phone number missing or incorrect.")
}
----

Finally the message text, if present:
[source,javascript]
----
// validate the message
if(args.message) {
  message.push("message:" +args.message)
}
----

=== Validation Done, Return the Result

With the validation phase, we added to the "errors" array all the errors we found, and to the "message" array all the data we want to show to the user. So if there are errors, we have to show them, otherwise we store the message and return a "thank you" page.

[source,javascript]
----
if(errors.length) {
  var errs = "<ul><li>"+errors.join("</li><li>")+"</li></ul>"
  return {
    body: "<h1>Errors!</h1>"+
      data + errs +
      '<br><a href="javascript:window.history.back()">Back</a>'
   }
} else {
   var data = "<pre>"+message.join("\n")+"</pre>"
   // storing in the database
   // TODO: <Store the message in the database> 
   return {
     body: "<h1>Thank you!</h1>"+ data
   }
}
----

The code is not yet complete, but let's start deploying it:

[source,bash]
----
nuv -wsk action create contact/submit submit.js --web true
ok: created action contact/submit
----

Now if you go to the contact form page and submit it correctly, you should see the "Thank you" page.

image::submit.png["Submit Result",align="center"]

Almost like magic, the submit action is automatically triggered by the form submit button with the right data.
